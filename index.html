<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Booking Wizard – as-tech</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
    theme: {
      extend: {
        colors: {
          brand: "#2B7FDB",
          gold: "#F7BF22",
          silver: "#D4D6D7",
          charcoal: "#1C1B20",
          slate: "#363740",
          ink: "#010103"
        }
      }
    }
  }
  </script>

  <style>
    /* AsTech light theme accents (readability-first) */
    .service-card { border-color: rgba(17,24,39,.12); }
    .service-card:hover { border-color: rgba(43,127,219,.45); }
    .panel-card { background: #FFFFFF; border: 1px solid rgba(17,24,39,.10); box-shadow: 0 10px 30px rgba(17,24,39,.06); border-radius: 16px; }
    .muted { color: rgba(17,24,39,.65); }
  </style>

</head>

<body class="bg-white text-gray-900">
  <header class="sticky top-0 z-50 bg-white/90 border-b backdrop-blur">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="assets/astech-logo.png" alt="AsTech" class="h-10 w-auto" />
        <div class="leading-tight">
          <div class="font-extrabold tracking-wide text-gray-900">AsTech</div>
          <div class="text-xs text-gray-500">TV Mounting • Furniture Assembly • Soundbar • Cameras / Devices</div>
        </div>
      </div>
      <a href="#wizard" class="hidden md:inline-flex bg-brand text-white px-4 py-2 rounded-md font-semibold hover:brightness-110">Start</a>
    </div>
  </header>

  <section class="bg-gray-50">
    <div class="max-w-7xl mx-auto px-6 py-12 md:py-16 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <div class="inline-flex items-center gap-2 text-xs bg-white border rounded-full px-3 py-1 text-gray-600">
          Wizard • Live estimate • Cal.com embed
        </div>
        <h1 class="mt-4 text-4xl md:text-5xl font-extrabold leading-tight">
          Configure the job, then pick a real slot.
        </h1>
        <p class="mt-4 text-lg text-gray-600">
          Only relevant questions are shown per service. Scheduling is handled by Cal.com with pending approval.
        </p>
        <div class="mt-7 flex gap-3">
          <a href="#wizard" class="bg-brand text-white px-6 py-3 rounded-md font-semibold hover:bg-blue-700">Start</a>
          <a href="#faq" class="border px-6 py-3 rounded-md font-semibold hover:bg-gray-100">FAQ</a>
        </div>
      </div>

      <div class="bg-white border rounded-xl p-6 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-sm font-semibold">Live estimate</div>
          <span class="text-xs bg-blue-50 text-brand border border-blue-100 px-2 py-1 rounded-full">Updates instantly</span>
        </div>
        <div class="mt-4 border rounded-lg p-4 bg-gray-50">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-xs text-gray-500">Current selection</div>
              <div id="miniService" class="font-semibold">None</div>
              <div id="miniDetails" class="text-sm text-gray-600 mt-1">Start the wizard to configure options.</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-gray-500">Estimate</div>
              <div id="miniTotal" class="text-2xl font-extrabold text-brand">$0</div>
            </div>
          </div>
        </div>
        <div class="mt-4 text-xs text-gray-500">
          Placeholder pricing. Adjust in the script.
        </div>
      </div>
    </div>
  </section>

  <section id="wizard" class="py-12 md:py-16">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex flex-col lg:flex-row gap-8 items-start">

        <div class="lg:w-2/3">
          <div class="flex items-center justify-between gap-4">
            <h2 class="text-3xl font-extrabold">Booking Wizard</h2>
            <button id="resetAll" class="border px-4 py-2 rounded-md font-semibold hover:bg-gray-100 text-sm">Reset</button>
          </div>
          <p class="mt-2 text-gray-600">Step 1–3. Step 3 embeds your Cal.com scheduler.</p>

          <div class="mt-6 bg-gray-100 rounded-lg p-3">
            <div class="flex items-center justify-between text-xs text-gray-600">
              <span id="progressLabel">Step 1 of 3</span>
              <span id="progressPct">0%</span>
            </div>
            <div class="mt-2 h-2 bg-white rounded-full overflow-hidden border">
              <div id="progressBar" class="h-full bg-brand" style="width: 0%"></div>
            </div>
          </div>

          <div class="mt-6 space-y-6">

            <!-- STEP 1 -->
            <div class="step border rounded-xl p-6" data-step="1">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="text-xs font-semibold text-gray-500">STEP 1</div>
                  <div class="text-xl font-bold">Choose a service</div>
                  <div class="text-gray-600 mt-1">Click a card to continue.</div>
                </div>
                <span id="step1Status" class="text-xs bg-gray-100 border px-2 py-1 rounded-full text-gray-600">Required</span>
              </div>

              <div class="mt-5 grid md:grid-cols-2 gap-4">
                <button class="service-card text-left border rounded-xl p-5 hover:shadow-md transition"
                        data-service="TV Mounting" data-key="tv_mount">
                  <div class="font-bold text-lg">TV Mounting</div>
                  <div class="text-gray-600 mt-1 text-sm">Size, mount type, wall type, add-ons.</div>
                  <div class="mt-3 text-sm font-semibold text-brand">From $129</div>
                </button>

                <button class="service-card text-left border rounded-xl p-5 hover:shadow-md transition"
                        data-service="Furniture Assembly" data-key="furniture">
                  <div class="font-bold text-lg">Furniture Assembly</div>
                  <div class="text-gray-600 mt-1 text-sm">Count, complexity, optional anchoring.</div>
                  <div class="mt-3 text-sm font-semibold text-brand">From $89</div>
                </button>

                <button class="service-card text-left border rounded-xl p-5 hover:shadow-md transition"
                        data-service="Soundbar Installation" data-key="soundbar">
                  <div class="font-bold text-lg">Soundbar</div>
                  <div class="text-gray-600 mt-1 text-sm">Standalone or with TV.</div>
                  <div class="mt-3 text-sm font-semibold text-brand">From $79</div>
                </button>

                <button class="service-card text-left border rounded-xl p-5 hover:shadow-md transition"
                        data-service="Cameras / Devices" data-key="cameras">
                  <div class="font-bold text-lg">Cameras / Devices</div>
                  <div class="text-gray-600 mt-1 text-sm">Count + complexity + surface type.</div>
                  <div class="mt-3 text-sm font-semibold text-brand">From $99</div>
                </button>
              </div>

              <div class="mt-5 flex gap-3">
                <button class="next bg-brand text-white px-5 py-3 rounded-md font-semibold hover:bg-blue-700 disabled:opacity-60" disabled>
                  Next: Options
                </button>
              </div>
            </div>

            <!-- STEP 2 -->
            <div class="step border rounded-xl p-6" data-step="2">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="text-xs font-semibold text-gray-500">STEP 2</div>
                  <div class="text-xl font-bold">Job details</div>
                  <div class="text-gray-600 mt-1">Only relevant questions are shown for the selected service.</div>
                </div>
                <span id="step2Status" class="text-xs bg-gray-100 border px-2 py-1 rounded-full text-gray-600">Required</span>
              </div>

              <!-- TV Mounting -->
              <div id="panel-tv_mount" class="mt-6 hidden">
                <div class="font-semibold">TV Mounting</div>

                <div class="mt-4 grid sm:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">TV Size</div>
                    <select id="tvSize" class="w-full border rounded-md p-3">
                      <option value="small">Up to 43"</option>
                      <option value="mid">44"–65"</option>
                      <option value="large">66"–85"</option>
                      <option value="xl">86"+</option>
                    </select>
                  </label>

                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Mount Type</div>
                    <select id="mountType" class="w-full border rounded-md p-3">
                      <option value="fixed">Fixed</option>
                      <option value="tilt">Tilt</option>
                      <option value="full">Full Motion</option>
                      <option value="fireplace">Above Fireplace / Specialty</option>
                    </select>
                  </label>
                </div>

                <div class="mt-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Wall type</div>
                    <select id="tvWallType" class="w-full border rounded-md p-3">
                      <option value="drywall_studs">Drywall (studs)</option>
                      <option value="drywall_no_studs">Drywall (no studs / unsure)</option>
                      <option value="concrete_brick">Concrete / Brick</option>
                      <option value="metal_studs">Metal studs</option>
                    </select>
                  </label>
                  <div class="mt-3 border rounded-lg p-4 bg-gray-50">
                    <div class="text-sm font-semibold">Wall note</div>
                    <div id="tvWallNote" class="text-sm text-gray-700 mt-1"></div>
                  </div>
                </div>

                <div class="mt-4 grid sm:grid-cols-2 gap-3">
                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="addonConceal" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">Cable Concealment (surface)</div>
                      <div class="text-xs text-gray-600">Raceway / conceal kit</div>
                    </div>
                  </label>

                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="addonSoundbar" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">Add Soundbar Install</div>
                      <div class="text-xs text-gray-600">Mount + align soundbar</div>
                    </div>
                  </label>

                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="addonInWall" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">In-wall Wiring</div>
                      <div class="text-xs text-gray-600">Quote only (assessment)</div>
                    </div>
                  </label>

                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="addonDismount" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">Dismount Old TV</div>
                      <div class="text-xs text-gray-600">Remove existing mount</div>
                    </div>
                  </label>
                </div>

                <div class="mt-6 grid md:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">City / area</div>
                    <input id="tvCity" class="w-full border rounded-md p-3" placeholder="Vancouver / Surrey / Langley" />
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Photos link (recommended)</div>
                    <input id="tvPhotoLink" class="w-full border rounded-md p-3" placeholder="Google Drive / iCloud / Dropbox link" />
                  </label>
                </div>

                <label class="text-sm block mt-4">
                  <div class="font-medium text-gray-700 mb-1">Notes</div>
                  <input id="tvNotes" class="w-full border rounded-md p-3" placeholder="Fireplace height, power outlet location, existing holes, etc." />
                </label>
              </div>

              <!-- Furniture Assembly -->
              <div id="panel-furniture" class="mt-6 hidden">
                <div class="font-semibold">Furniture Assembly</div>

                <div class="mt-4 grid sm:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Item type</div>
                    <select id="furnType" class="w-full border rounded-md p-3">
                      <option value="small">Small (chair, side table, nightstand)</option>
                      <option value="medium">Medium (desk, dresser, TV stand)</option>
                      <option value="large">Large (bed frame, wardrobe, sectional)</option>
                      <option value="complex">Complex (pax-style, wall systems)</option>
                    </select>
                  </label>

                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">How many items?</div>
                    <select id="furnCount" class="w-full border rounded-md p-3">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5+</option>
                    </select>
                  </label>
                </div>

                <div class="mt-4 grid sm:grid-cols-2 gap-3">
                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="furnAnchor" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">Wall anchoring (optional)</div>
                      <div class="text-xs text-gray-600">Anti-tip / safety anchor install</div>
                    </div>
                  </label>

                  <label class="flex items-center gap-3 border rounded-md p-3 cursor-pointer">
                    <input id="furnDisposal" type="checkbox" class="h-4 w-4" />
                    <div>
                      <div class="font-medium text-sm">Box cleanup</div>
                      <div class="text-xs text-gray-600">Basic packaging cleanup/stacking</div>
                    </div>
                  </label>
                </div>

                <!-- Wall type only if anchoring -->
                <div id="furnWallWrap" class="mt-4 hidden">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Wall type (for anchoring)</div>
                    <select id="furnWallType" class="w-full border rounded-md p-3">
                      <option value="drywall_studs">Drywall (studs)</option>
                      <option value="drywall_no_studs">Drywall (no studs / unsure)</option>
                      <option value="concrete_brick">Concrete / Brick</option>
                      <option value="metal_studs">Metal studs</option>
                    </select>
                  </label>
                  <div class="mt-3 border rounded-lg p-4 bg-gray-50">
                    <div class="text-sm font-semibold">Wall note</div>
                    <div id="furnWallNote" class="text-sm text-gray-700 mt-1"></div>
                  </div>
                </div>

                <div class="mt-6 grid md:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">City / area</div>
                    <input id="furnCity" class="w-full border rounded-md p-3" placeholder="Vancouver / Surrey / Langley" />
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Photos link (recommended)</div>
                    <input id="furnPhotoLink" class="w-full border rounded-md p-3" placeholder="Product page + room photos if possible" />
                  </label>
                </div>

                <label class="text-sm block mt-4">
                  <div class="font-medium text-gray-700 mb-1">Notes</div>
                  <input id="furnNotes" class="w-full border rounded-md p-3" placeholder="Brand/model link, stairs/elevator, parking, room, etc." />
                </label>
              </div>

              <!-- Soundbar -->
              <div id="panel-soundbar" class="mt-6 hidden">
                <div class="font-semibold">Soundbar</div>

                <div class="mt-4 grid sm:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Installation Type</div>
                    <select id="soundbarType" class="w-full border rounded-md p-3">
                      <option value="standalone">Standalone soundbar install</option>
                      <option value="with_tv">Installed with TV mount</option>
                    </select>
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Cable tidy</div>
                    <select id="soundbarCables" class="w-full border rounded-md p-3">
                      <option value="basic">Basic tidy</option>
                      <option value="conceal">Conceal cables (surface)</option>
                    </select>
                  </label>
                </div>

                <div class="mt-6 grid md:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">City / area</div>
                    <input id="soundCity" class="w-full border rounded-md p-3" placeholder="Vancouver / Surrey / Langley" />
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Photos link (optional)</div>
                    <input id="soundPhotoLink" class="w-full border rounded-md p-3" placeholder="Wall/TV area + soundbar model" />
                  </label>
                </div>

                <label class="text-sm block mt-4">
                  <div class="font-medium text-gray-700 mb-1">Notes</div>
                  <input id="soundNotes" class="w-full border rounded-md p-3" placeholder="TV model, mounting preference, cable routing, etc." />
                </label>
              </div>

              <!-- Cameras -->
              <div id="panel-cameras" class="mt-6 hidden">
                <div class="font-semibold">Cameras / Devices</div>

                <div class="mt-4 grid sm:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Number of devices</div>
                    <select id="cameraCount" class="w-full border rounded-md p-3">
                      <option value="1">1 device</option>
                      <option value="2">2 devices</option>
                      <option value="3">3 devices</option>
                      <option value="4">4 devices</option>
                    </select>
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Complexity</div>
                    <select id="cameraComplexity" class="w-full border rounded-md p-3">
                      <option value="basic">Basic mount</option>
                      <option value="standard">Standard (routing / minor setup)</option>
                      <option value="advanced">Advanced (long routing / tricky surfaces)</option>
                    </select>
                  </label>
                </div>

                <div class="mt-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Surface type (optional)</div>
                    <select id="camSurface" class="w-full border rounded-md p-3">
                      <option value="standard">Standard (wood/drywall)</option>
                      <option value="brick">Brick / concrete</option>
                      <option value="siding">Exterior siding</option>
                      <option value="unknown">Not sure</option>
                    </select>
                  </label>
                </div>

                <div class="mt-6 grid md:grid-cols-2 gap-4">
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">City / area</div>
                    <input id="camCity" class="w-full border rounded-md p-3" placeholder="Vancouver / Surrey / Langley" />
                  </label>
                  <label class="text-sm">
                    <div class="font-medium text-gray-700 mb-1">Photos link (recommended)</div>
                    <input id="camPhotoLink" class="w-full border rounded-md p-3" placeholder="Install locations + power/coverage" />
                  </label>
                </div>

                <label class="text-sm block mt-4">
                  <div class="font-medium text-gray-700 mb-1">Notes</div>
                  <input id="camNotes" class="w-full border rounded-md p-3" placeholder="Device models, areas to cover, Wi-Fi info, access, etc." />
                </label>
              </div>

              <div class="mt-6 flex flex-col sm:flex-row gap-3">
                <button class="prev border px-5 py-3 rounded-md font-semibold hover:bg-gray-100">Back</button>
                <button class="next bg-brand text-white px-5 py-3 rounded-md font-semibold hover:bg-blue-700 disabled:opacity-60" disabled>
                  Next: Schedule (Cal.com)
                </button>
              </div>
            </div>

            <!-- STEP 3 (Cal.com embed) -->
            <div class="step border rounded-xl p-6" data-step="3">
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="text-xs font-semibold text-gray-500">STEP 3</div>
                  <div class="text-xl font-bold">Pick a slot (Cal.com)</div>
                  <div class="text-gray-600 mt-1">
                    Scheduler shows only available times. Your wizard summary is prefilled into Cal.com booking notes.
                  </div>
                </div>
                <span class="text-xs bg-green-50 border border-green-200 px-2 py-1 rounded-full text-green-700">Live scheduler</span>
              </div>

              <div class="mt-5 flex flex-col md:flex-row gap-3">
                <button id="loadCal" class="bg-brand text-white px-5 py-3 rounded-md font-semibold hover:bg-blue-700">
                  Load scheduler with my selections
                </button>
                <button id="copySummary" class="border px-5 py-3 rounded-md font-semibold hover:bg-gray-100">
                  Copy wizard summary
                </button>
              </div>

              <div class="mt-6 border rounded-xl overflow-hidden">
                <iframe id="calFrame" title="Cal.com Scheduler" style="width:100%; height: 820px; border:0;" loading="lazy"></iframe>
              </div>

              <div class="mt-6 flex flex-col sm:flex-row gap-3">
                <button class="prev border px-5 py-3 rounded-md font-semibold hover:bg-gray-100">Back</button>
              </div>
            </div>

          </div>
        </div>

        <!-- Right Summary -->
        <div class="lg:w-1/3 lg:sticky lg:top-24">
          <div class="border rounded-xl p-6 bg-white shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xs text-gray-500">Estimate</div>
                <div id="summaryTotal" class="text-3xl font-extrabold text-brand">$0</div>
              </div>
              <span id="serviceBadge" class="text-xs bg-gray-100 border px-2 py-1 rounded-full text-gray-600">No service</span>
            </div>

            <div class="mt-4 border rounded-lg p-4 bg-gray-50">
              <div class="text-sm font-semibold" id="summaryService">No service selected</div>
              <div id="summaryLines" class="mt-3 space-y-2 text-sm text-gray-800">
                <div class="text-gray-500">Choose a service to see line items.</div>
              </div>
            </div>

            <div class="mt-4 text-xs text-gray-500">
              In-wall wiring is “Quote” by default.
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <section id="faq" class="bg-gray-50 py-12 md:py-16">
    <div class="max-w-7xl mx-auto px-6">
      <h2 class="text-3xl font-extrabold text-center">FAQ</h2>
      <div class="max-w-3xl mx-auto mt-8 grid gap-3">
        <details class="bg-white border rounded-xl p-5">
          <summary class="font-semibold cursor-pointer">How does pending approval work?</summary>
          <div class="mt-2 text-gray-600 text-sm">
            Enable “Requires confirmation” in Cal.com event settings. Requests arrive pending; you approve from your phone/app.
          </div>
        </details>
      </div>
    </div>
  </section>

  <footer class="bg-gray-900 text-gray-300 py-10">
    <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
      <div>© 2026 as-tech</div>
      <div class="flex gap-6 text-sm">
        <a href="#wizard" class="hover:text-white">Wizard</a>
        <a href="#faq" class="hover:text-white">FAQ</a>
      </div>
    </div>
  </footer>

  <script>
    /***********************
     * Cal.com embed config
     ***********************/
    const CAL_USERNAME = "as-tech";
    const CAL_EVENT_SLUG = "YOUR_EVENT_SLUG"; // set this to the slug after cal.com/as-tech/...

    /******************************************************************
     * Pricing (placeholder)
     ******************************************************************/
    const pricing = {
      tv_mount: {
        base: 129,
        size: { small: 0, mid: 20, large: 50, xl: 90 },
        mount: { fixed: 0, tilt: 20, full: 60, fireplace: 120 },
        addons: { conceal: 35, soundbar: 79, dismount: 30 }
      },
      furniture: {
        base: 89,
        type: { small: 0, medium: 40, large: 90, complex: 160 },
        count: { "1": 0, "2": 60, "3": 110, "4": 160, "5": 220 },
        addons: { anchor: 25, cleanup: 15 }
      },
      soundbar: {
        base: 79,
        type: { standalone: 0, with_tv: -20 },
        cables: { basic: 0, conceal: 25 }
      },
      cameras: {
        base: 99,
        count: { "1": 0, "2": 60, "3": 120, "4": 170 },
        complexity: { basic: 0, standard: 40, advanced: 90 },
        surface: { standard: 0, brick: 30, siding: 20, unknown: 0 }
      }
    };

    const wallAdjust = {
      drywall_studs: { add: 0, note: "Standard install assumptions. Stud anchoring where applicable." },
      drywall_no_studs: { add: 30, note: "May require anchors/toggle bolts and extra time to locate framing." },
      concrete_brick: { add: 70, note: "Masonry drilling required. Additional time and hardware may apply." },
      metal_studs: { add: 60, note: "Metal stud anchors/backing may be needed. Extra time typically required." }
    };

    const $ = (id) => document.getElementById(id);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const money = (n) => "$" + Number(n).toFixed(0);

    const state = {
      step: 1,
      serviceKey: null,
      serviceName: null,
      estimate: { total: 0, lines: [] }
    };

    function setProgress(){
      const pct = Math.round(((state.step - 1) / 2) * 100);
      $("progressLabel").textContent = `Step ${state.step} of 3`;
      $("progressPct").textContent = `${pct}%`;
      $("progressBar").style.width = `${pct}%`;
    }

    function showStep(step){
      state.step = step;
      $$(".step").forEach(el => el.style.display = (Number(el.dataset.step) === step) ? "block" : "none");
      setProgress();
    }

    function setStatus(id, ok){
      const el = $(id);
      if (!el) return;
      if (ok){
        el.textContent = "Done";
        el.className = "text-xs bg-green-50 border border-green-200 px-2 py-1 rounded-full text-green-700";
      } else {
        el.textContent = "Required";
        el.className = "text-xs bg-gray-100 border px-2 py-1 rounded-full text-gray-600";
      }
    }

    function hideAllPanels(){
      ["tv_mount","furniture","soundbar","cameras"].forEach(k => $("panel-" + k).classList.add("hidden"));
    }

    function wallLabel(v){
      return ({
        drywall_studs: "Drywall (studs)",
        drywall_no_studs: "Drywall (no studs/unsure)",
        concrete_brick: "Concrete / Brick",
        metal_studs: "Metal studs"
      })[v] || v;
    }
    function updateWallNoteTV(){
      const w = $("tvWallType").value;
      $("tvWallNote").textContent = wallAdjust[w].note;
    }
    function updateWallNoteFurn(){
      const w = $("furnWallType").value;
      $("furnWallNote").textContent = wallAdjust[w].note;
    }

    function validateStep1(){
      const ok = !!state.serviceKey;
      setStatus("step1Status", ok);
      document.querySelector('.step[data-step="1"] .next').disabled = !ok;
      return ok;
    }

    function validateStep2(){
      const ok = !!state.serviceKey;
      setStatus("step2Status", ok);
      document.querySelector('.step[data-step="2"] .next').disabled = !ok;
      return ok;
    }

    function selectService(key, name){
      state.serviceKey = key;
      state.serviceName = name;
      hideAllPanels();
      $("panel-" + key).classList.remove("hidden");
      validateStep1();
      validateStep2();
      calcEstimate();
    }

    function calcEstimate(){
      if (!state.serviceKey){
        state.estimate = { total: 0, lines: [] };
        renderSummary();
        renderMini();
        return;
      }

      let total = 0;
      const lines = [];

      if (state.serviceKey === "tv_mount"){
        const p = pricing.tv_mount;
        const size = $("tvSize").value;
        const mount = $("mountType").value;
        const wall = $("tvWallType").value;

        total += p.base + p.size[size] + p.mount[mount];
        lines.push({ label: "Base TV mount", value: money(p.base) });
        lines.push({ label: `TV size`, value: money(p.size[size]) });
        lines.push({ label: `Mount type`, value: money(p.mount[mount]) });

        if ($("addonConceal").checked){ total += p.addons.conceal; lines.push({ label: "Cable conceal (surface)", value: money(p.addons.conceal) }); }
        if ($("addonSoundbar").checked){ total += p.addons.soundbar; lines.push({ label: "Soundbar add-on", value: money(p.addons.soundbar) }); }
        if ($("addonDismount").checked){ total += p.addons.dismount; lines.push({ label: "Dismount old TV", value: money(p.addons.dismount) }); }
        if ($("addonInWall").checked){ lines.push({ label: "In-wall wiring", value: "Quote" }); }

        const wallAdd = wallAdjust[wall]?.add ?? 0;
        total += wallAdd;
        lines.push({ label: `Wall type`, value: money(wallAdd) });
      }

      if (state.serviceKey === "furniture"){
        const p = pricing.furniture;
        const type = $("furnType").value;
        const count = $("furnCount").value;
        const anchor = $("furnAnchor").checked;
        const cleanup = $("furnDisposal").checked;

        total += p.base + p.type[type] + p.count[count];
        lines.push({ label: "Base assembly", value: money(p.base) });
        lines.push({ label: "Item type", value: money(p.type[type]) });
        lines.push({ label: "Item count", value: money(p.count[count]) });

        if (anchor){ total += p.addons.anchor; lines.push({ label: "Wall anchoring", value: money(p.addons.anchor) }); }
        if (cleanup){ total += p.addons.cleanup; lines.push({ label: "Box cleanup", value: money(p.addons.cleanup) }); }

        if (anchor){
          const wall = $("furnWallType").value;
          const wallAdd = wallAdjust[wall]?.add ?? 0;
          total += wallAdd;
          lines.push({ label: "Wall type (anchoring)", value: money(wallAdd) });
        } else {
          lines.push({ label: "Wall anchoring", value: "No" });
        }
      }

      if (state.serviceKey === "soundbar"){
        const p = pricing.soundbar;
        const type = $("soundbarType").value;
        const cables = $("soundbarCables").value;
        total += p.base + p.type[type] + p.cables[cables];
        lines.push({ label: "Base soundbar install", value: money(p.base) });
        lines.push({ label: "Type", value: money(p.type[type]) });
        lines.push({ label: "Cable tidy", value: money(p.cables[cables]) });
      }

      if (state.serviceKey === "cameras"){
        const p = pricing.cameras;
        const count = $("cameraCount").value;
        const complexity = $("cameraComplexity").value;
        const surface = $("camSurface").value;

        total += p.base + p.count[count] + p.complexity[complexity] + p.surface[surface];
        lines.push({ label: "Base device install", value: money(p.base) });
        lines.push({ label: "Devices", value: money(p.count[count]) });
        lines.push({ label: "Complexity", value: money(p.complexity[complexity]) });
        lines.push({ label: "Surface type", value: money(p.surface[surface]) });
      }

      state.estimate = { total, lines };
      renderSummary();
      renderMini();
    }

    function renderSummary(){
      $("summaryTotal").textContent = money(state.estimate.total);
      $("serviceBadge").textContent = state.serviceName || "No service";
      $("summaryService").textContent = state.serviceName || "No service selected";
      const box = $("summaryLines");
      box.innerHTML = "";
      if (!state.serviceKey){
        box.innerHTML = `<div class="text-gray-500">Choose a service to see line items.</div>`;
        return;
      }
      state.estimate.lines.forEach(l => {
        const row = document.createElement("div");
        row.className = "flex justify-between gap-4";
        row.innerHTML = `<span class="text-gray-700">${l.label}</span><span class="font-semibold">${l.value}</span>`;
        box.appendChild(row);
      });
    }

    function renderMini(){
      $("miniService").textContent = state.serviceName || "None";
      $("miniTotal").textContent = money(state.estimate.total);
      $("miniDetails").textContent = state.serviceKey ? "Configured. Proceed to scheduling." : "Start the wizard to configure options.";
    }

    function getServiceSpecificDetails(){
      // Collect only the relevant inputs based on selected service
      if (state.serviceKey === "tv_mount"){
        return {
          city: $("tvCity").value || "",
          photos: $("tvPhotoLink").value || "",
          notes: $("tvNotes").value || "",
          wallType: $("tvWallType").value,
          tvSize: $("tvSize").value,
          mountType: $("mountType").value,
          addons: {
            conceal: $("addonConceal").checked,
            soundbar: $("addonSoundbar").checked,
            inwall: $("addonInWall").checked,
            dismount: $("addonDismount").checked
          }
        };
      }

      if (state.serviceKey === "furniture"){
        return {
          city: $("furnCity").value || "",
          photos: $("furnPhotoLink").value || "",
          notes: $("furnNotes").value || "",
          type: $("furnType").value,
          count: $("furnCount").value,
          anchor: $("furnAnchor").checked,
          cleanup: $("furnDisposal").checked,
          wallType: $("furnAnchor").checked ? $("furnWallType").value : ""
        };
      }

      if (state.serviceKey === "soundbar"){
        return {
          city: $("soundCity").value || "",
          photos: $("soundPhotoLink").value || "",
          notes: $("soundNotes").value || "",
          type: $("soundbarType").value,
          cables: $("soundbarCables").value
        };
      }

      if (state.serviceKey === "cameras"){
        return {
          city: $("camCity").value || "",
          photos: $("camPhotoLink").value || "",
          notes: $("camNotes").value || "",
          count: $("cameraCount").value,
          complexity: $("cameraComplexity").value,
          surface: $("camSurface").value
        };
      }

      return {};
    }

    function buildSummaryText(){
      const d = getServiceSpecificDetails();
      const lines = [];
      lines.push(`Service: ${state.serviceName || "—"}`);
      lines.push(`Estimate: ${money(state.estimate.total)}`);
      if (d.city) lines.push(`City/Area: ${d.city}`);
      if (d.photos) lines.push(`Photos: ${d.photos}`);
      if (d.notes) lines.push(`Notes: ${d.notes}`);
      lines.push("");

      if (state.serviceKey === "tv_mount"){
        lines.push("TV Mounting:");
        lines.push(`- TV size: ${$("tvSize").selectedOptions[0].textContent}`);
        lines.push(`- Mount type: ${$("mountType").selectedOptions[0].textContent}`);
        lines.push(`- Wall type: ${wallLabel(d.wallType)}`);
        const addons = [];
        if (d.addons.conceal) addons.push("Cable conceal (surface)");
        if (d.addons.soundbar) addons.push("Soundbar add-on");
        if (d.addons.dismount) addons.push("Dismount old TV");
        if (d.addons.inwall) addons.push("In-wall wiring (quote)");
        lines.push(`- Add-ons: ${addons.length ? addons.join(", ") : "None"}`);
      }

      if (state.serviceKey === "furniture"){
        lines.push("Furniture Assembly:");
        lines.push(`- Item type: ${$("furnType").selectedOptions[0].textContent}`);
        lines.push(`- Count: ${$("furnCount").selectedOptions[0].textContent}`);
        lines.push(`- Wall anchoring: ${d.anchor ? "Yes" : "No"}`);
        lines.push(`- Box cleanup: ${d.cleanup ? "Yes" : "No"}`);
        if (d.anchor && d.wallType) lines.push(`- Wall type (anchoring): ${wallLabel(d.wallType)}`);
      }

      if (state.serviceKey === "soundbar"){
        lines.push("Soundbar:");
        lines.push(`- Type: ${$("soundbarType").selectedOptions[0].textContent}`);
        lines.push(`- Cable tidy: ${$("soundbarCables").selectedOptions[0].textContent}`);
      }

      if (state.serviceKey === "cameras"){
        lines.push("Cameras/Devices:");
        lines.push(`- Devices: ${$("cameraCount").selectedOptions[0].textContent}`);
        lines.push(`- Complexity: ${$("cameraComplexity").selectedOptions[0].textContent}`);
        lines.push(`- Surface: ${$("camSurface").selectedOptions[0].textContent}`);
      }

      lines.push("");
      lines.push("Customer info will be collected in Cal.com.");
      return lines.join("\n");
    }

    function loadCalEmbed(){
      if (!CAL_EVENT_SLUG || CAL_EVENT_SLUG === "YOUR_EVENT_SLUG"){
        alert("Set CAL_EVENT_SLUG in the script (the part after cal.com/as-tech/...).");
        return;
      }
      const notes = encodeURIComponent(buildSummaryText());
      const url = `https://cal.com/${CAL_USERNAME}/${CAL_EVENT_SLUG}?notes=${notes}`;
      $("calFrame").src = url;
    }

    // Service cards
    $$(".service-card").forEach(btn => btn.addEventListener("click", () => selectService(btn.dataset.key, btn.dataset.service)));

    // Step nav
    $$(".next").forEach(btn => btn.addEventListener("click", () => {
      if (state.step === 1 && !validateStep1()) return;
      if (state.step === 2 && !validateStep2()) return;
      showStep(state.step + 1);
    }));
    $$(".prev").forEach(btn => btn.addEventListener("click", () => showStep(state.step - 1)));

    // Furniture anchoring toggles wall type section
    $("furnAnchor").addEventListener("change", () => {
      $("furnWallWrap").classList.toggle("hidden", !$("furnAnchor").checked);
      if ($("furnAnchor").checked) updateWallNoteFurn();
      calcEstimate();
    });

    // Wall note update listeners
    $("tvWallType").addEventListener("change", () => { updateWallNoteTV(); calcEstimate(); });
    $("furnWallType").addEventListener("change", () => { updateWallNoteFurn(); calcEstimate(); });

    // Recalc listeners for all service-specific inputs
    const recalcIds = [
      "tvSize","mountType","addonConceal","addonSoundbar","addonInWall","addonDismount","tvCity","tvPhotoLink","tvNotes",
      "furnType","furnCount","furnDisposal","furnCity","furnPhotoLink","furnNotes",
      "soundbarType","soundbarCables","soundCity","soundPhotoLink","soundNotes",
      "cameraCount","cameraComplexity","camSurface","camCity","camPhotoLink","camNotes"
    ];
    recalcIds.forEach(id => {
      const el = $(id);
      if (!el) return;
      el.addEventListener("change", calcEstimate);
      el.addEventListener("input", calcEstimate);
    });

    // Cal buttons
    $("loadCal").addEventListener("click", loadCalEmbed);
    $("copySummary").addEventListener("click", async () => {
      const txt = buildSummaryText();
      try { await navigator.clipboard.writeText(txt); alert("Wizard summary copied."); }
      catch { alert("Clipboard blocked. Copy manually if needed."); }
    });

    // Reset
    function resetAll(){
      state.step = 1;
      state.serviceKey = null;
      state.serviceName = null;
      state.estimate = { total: 0, lines: [] };

      hideAllPanels();
      $("calFrame").src = "";

      setStatus("step1Status", false);
      setStatus("step2Status", false);

      document.querySelector('.step[data-step="1"] .next').disabled = true;
      document.querySelector('.step[data-step="2"] .next').disabled = true;

      $("furnWallWrap").classList.add("hidden");

      updateWallNoteTV();
      updateWallNoteFurn();

      calcEstimate();
      showStep(1);
    }
    $("resetAll").addEventListener("click", resetAll);

    // Init
    function init(){
      showStep(1);
      hideAllPanels();
      document.querySelector('.step[data-step="1"] .next').disabled = true;
      document.querySelector('.step[data-step="2"] .next').disabled = true;

      updateWallNoteTV();
      updateWallNoteFurn();

      setStatus("step1Status", false);
      setStatus("step2Status", false);

      calcEstimate();
    }
    init();
  </script>
</body>
</html>
